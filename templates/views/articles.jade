extends ../layouts/default

mixin post(post, isS3Enabled)
	.post.col-md-6
		if (post.postThumbnailImage.exists)
			- var postUrl = isS3Enabled ? post.postThumbnailImage.url : ('/post/images/' + post.postThumbnailImage.filename);
		else 
			- var postUrl = ''; 
		div(style="background-image:url('" + postUrl + "');").post-thumbnail
			.category-labels
				if post.authors && post.authors.length
					each auth, auth_i in post.authors
						a(href='/author/' + auth.slug).label= auth.authorName
					span.label.dark=post._.publishedDate.format('YYYY.MM.DD')
				if post.categories && post.categories.length
					each cat, cat_i in post.categories
						a(href='/articles/' + cat.key).label.dark=cat.name	
		.post-author-date
			
		.post-info
			a(href='/articles/post/' + post.slug).post-title
				!=post.title
			.post-brief
				!=post.content.brief

block intro
	.container
		h2.page-heading
			if data.category
				!=data.category.name
			else
				.page-heading-name-ch 文录 
				.page-heading-name-en articles

block content
	link(href="/styles/site/articles.min.css", rel="stylesheet")
	.container: .row
		.col-md-9.col-sm-7
			if filters.category && !data.category
				h3.text-muted Invalid Category.
			else
				if data.posts.results.length
					.articles.row
						each post in data.posts.results
							+post(post, data.isS3Enabled)
					
					if data.posts.totalPages > 1
						ul.pagination
							if data.posts.previous
								li: a(href='?page=' + data.posts.previous): span.glyphicon.glyphicon-chevron-left
							else
								li.disabled: a(href='?page=' + 1): span.glyphicon.glyphicon-chevron-left
							each p, i in data.posts.pages
								li(class=data.posts.currentPage == p ? 'active' : null)
									a(href='?page=' + (p == '...' ? (i ? data.posts.totalPages : 1) : p ))= p
							if data.posts.next
								li: a(href='?page=' + data.posts.next): span.glyphicon.glyphicon-chevron-right
							else
								li.disabled: a(href='?page=' + data.posts.totalPages): span.entypo.glyphicon.glyphicon-chevron-right
				else
					.row
						.col-md-6
							if data.category
								h3.text-muted "#{data.category.name}"这集子好像是空的!
							else
								h3.text-muted 哎呀,竟然暴露了我们没文章的事实.
		
		if data.categories.length
			.col-md-3.col-sm-5.hidden-xs
				.list-group.category-list
					a(href='/articles', class=!data.category ? 'active' : false).list-group-item 所有的集子
					each cat in data.categories
						a(href='/articles/' + cat.key, class=data.category && data.category.id == cat.id ? 'active' : false).list-group-item= cat.name
